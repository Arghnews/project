<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>7.1. Render Pass Creation</title><link rel="stylesheet" type="text/css" href="config/vkspec-xhtml.css" /><meta name="generator" content="DocBook XSL Stylesheets V1.79.1" /><link rel="home" href="index.html" title="Vulkan 1.0.30 - A Specification (with WSI extensions)" /><link rel="up" href="ch07.html" title="Chapter 7. Render Pass" /><link rel="prev" href="ch07.html" title="Chapter 7. Render Pass" /><link rel="next" href="ch07s02.html" title="7.2. Render Pass Compatibility" /><script xmlns="" type="text/x-mathjax-config">
        MathJax.Hub.Config({
            MathML: { extensions: ["content-mathml.js"] },
            tex2jax: { inlineMath: [['$','$'], ['\\(','\\)']] }
        });
    </script><script xmlns="" type="text/javascript" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script></head><body><div class="navheader"><table width="100%" summary="Navigation header"><tr><td width="20%" align="left"><a accesskey="p" href="ch07.html"><img src="images/icons/prev.png" alt="Prev" /></a> </td><th width="60%" align="center"> </th><td width="20%" align="right"> <a accesskey="n" href="ch07s02.html"><img src="images/icons/next.png" alt="Next" /></a></td></tr></table><hr /></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="renderpass-creation"></a>7.1. Render Pass Creation</h2></div></div></div><p>To create a render pass, call:</p><p><a id="vkCreateRenderPass"></a><strong> </strong>
</p><pre class="programlisting">VkResult vkCreateRenderPass(
    VkDevice                                    device,
    const VkRenderPassCreateInfo*               pCreateInfo,
    const VkAllocationCallbacks*                pAllocator,
    VkRenderPass*                               pRenderPass);</pre><p>
</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem">
<em class="parameter"><code>device</code></em> is the logical device that creates the render pass.
</li><li class="listitem">
<em class="parameter"><code>pCreateInfo</code></em> is a pointer to an instance of the
    <code class="code"><a class="link" href="ch07s01.html#VkRenderPassCreateInfo">VkRenderPassCreateInfo</a></code> structure that describes the parameters of
    the render pass.
</li><li class="listitem">
<em class="parameter"><code>pAllocator</code></em> controls host memory allocation as described in the
    <a class="link" href="ch10s01.html#memory-allocation">Memory Allocation</a> chapter.
</li><li class="listitem">
<em class="parameter"><code>pRenderPass</code></em> points to a <code class="code">VkRenderPass</code> handle in which the
    resulting render pass object is returned.
</li></ul></div><div class="sidebar"><div class="titlepage"><div><div><p class="title"><strong>Valid Usage (Implicit)</strong></p></div></div></div><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem">
<em class="parameter"><code>device</code></em> <span class="normative">must</span> be a valid <code class="code">VkDevice</code> handle
</li><li class="listitem">
<em class="parameter"><code>pCreateInfo</code></em> <span class="normative">must</span> be a pointer to a valid <code class="code">VkRenderPassCreateInfo</code> structure
</li><li class="listitem">
If <em class="parameter"><code>pAllocator</code></em> is not <code class="literal">NULL</code>, <em class="parameter"><code>pAllocator</code></em> <span class="normative">must</span> be a pointer to a valid <code class="code">VkAllocationCallbacks</code> structure
</li><li class="listitem">
<em class="parameter"><code>pRenderPass</code></em> <span class="normative">must</span> be a pointer to a <code class="code">VkRenderPass</code> handle
</li></ul></div></div><div class="sidebar"><div class="titlepage"><div><div><p class="title"><strong>Return Codes</strong></p></div></div></div><div class="variablelist"><dl class="variablelist"><dt><span class="term">
<a class="link" href="ch02s06.html#fundamentals-successcodes" title="Success Codes">Success</a>
</span></dt><dd><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem">
<code class="code">VK_SUCCESS</code>
</li></ul></div></dd><dt><span class="term">
<a class="link" href="ch02s06.html#fundamentals-errorcodes" title="Error codes">Failure</a>
</span></dt><dd><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem">
<code class="code">VK_ERROR_OUT_OF_HOST_MEMORY</code>
</li><li class="listitem">
<code class="code">VK_ERROR_OUT_OF_DEVICE_MEMORY</code>
</li></ul></div></dd></dl></div></div><p>The <code class="code">VkRenderPassCreateInfo</code> structure is defined as:</p><p><a id="VkRenderPassCreateInfo"></a><strong> </strong>
</p><pre class="programlisting">typedef struct VkRenderPassCreateInfo {
    VkStructureType                   sType;
    const void*                       pNext;
    VkRenderPassCreateFlags           flags;
    uint32_t                          attachmentCount;
    const VkAttachmentDescription*    pAttachments;
    uint32_t                          subpassCount;
    const VkSubpassDescription*       pSubpasses;
    uint32_t                          dependencyCount;
    const VkSubpassDependency*        pDependencies;
} VkRenderPassCreateInfo;</pre><p>
</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem">
<em class="parameter"><code>sType</code></em> is the type of this structure.
</li><li class="listitem">
<em class="parameter"><code>pNext</code></em> is <code class="literal">NULL</code> or a pointer to an extension-specific structure.
</li><li class="listitem">
<em class="parameter"><code>flags</code></em> is reserved for future use.
</li><li class="listitem">
<em class="parameter"><code>attachmentCount</code></em> is the number of attachments used by this render
    pass, or zero indicating no attachments.
    Attachments are referred to by zero-based indices in the range
    [0,<em class="parameter"><code>attachmentCount</code></em>).
</li><li class="listitem">
<em class="parameter"><code>pAttachments</code></em> points to an array of <em class="parameter"><code>attachmentCount</code></em> number of
    <code class="code"><a class="link" href="ch07s01.html#VkAttachmentDescription">VkAttachmentDescription</a></code> structures describing properties of the
    attachments, or <code class="literal">NULL</code> if <em class="parameter"><code>attachmentCount</code></em> is zero.
</li><li class="listitem">
<em class="parameter"><code>subpassCount</code></em> is the number of subpasses to create for this render
    pass.
    Subpasses are referred to by zero-based indices in the range
    [0,<em class="parameter"><code>subpassCount</code></em>).
    A render pass <span class="normative">must</span> have at least one subpass.
</li><li class="listitem">
<em class="parameter"><code>pSubpasses</code></em> points to an array of <em class="parameter"><code>subpassCount</code></em> number of
    <code class="code"><a class="link" href="ch07s01.html#VkSubpassDescription">VkSubpassDescription</a></code> structures describing properties of the
    subpasses.
</li><li class="listitem">
<em class="parameter"><code>dependencyCount</code></em> is the number of dependencies between pairs of
    subpasses, or zero indicating no dependencies.
</li><li class="listitem">
<em class="parameter"><code>pDependencies</code></em> points to an array of <em class="parameter"><code>dependencyCount</code></em> number
    of <code class="code"><a class="link" href="ch07s01.html#VkSubpassDependency">VkSubpassDependency</a></code> structures describing dependencies between
    pairs of subpasses, or <code class="literal">NULL</code> if <em class="parameter"><code>dependencyCount</code></em> is zero.
</li></ul></div><div class="sidebar"><div class="titlepage"><div><div><p class="title"><strong>Valid Usage</strong></p></div></div></div><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem">
If any two subpasses operate on attachments with overlapping ranges of
    the same <code class="code">VkDeviceMemory</code> object, and at least one subpass writes to
    that area of <code class="code">VkDeviceMemory</code>, a subpass dependency <span class="normative">must</span> be
    included (either directly or via some intermediate subpasses) between
    them
</li><li class="listitem">
If the <em class="parameter"><code>attachment</code></em> member of any element of
    <em class="parameter"><code>pInputAttachments</code></em>, <em class="parameter"><code>pColorAttachments</code></em>,
    <em class="parameter"><code>pResolveAttachments</code></em> or <em class="parameter"><code>pDepthStencilAttachment</code></em>, or the
    attachment indexed by any element of <em class="parameter"><code>pPreserveAttachments</code></em> in any
    given element of <em class="parameter"><code>pSubpasses</code></em> is bound to a range of a
    <code class="code">VkDeviceMemory</code> object that overlaps with any other attachment in
    any subpass (including the same subpass), the
    <code class="code">VkAttachmentDescription</code> structures describing them <span class="normative">must</span> include
    <code class="code">VK_ATTACHMENT_DESCRIPTION_MAY_ALIAS_BIT</code> in <em class="parameter"><code>flags</code></em>
</li><li class="listitem">
If the <em class="parameter"><code>attachment</code></em> member of any element of
    <em class="parameter"><code>pInputAttachments</code></em>, <em class="parameter"><code>pColorAttachments</code></em>,
    <em class="parameter"><code>pResolveAttachments</code></em> or <em class="parameter"><code>pDepthStencilAttachment</code></em>, or any
    element of <em class="parameter"><code>pPreserveAttachments</code></em> in any given element of
    <em class="parameter"><code>pSubpasses</code></em> is not <code class="code">VK_ATTACHMENT_UNUSED</code>, it <span class="normative">must</span> be less
    than <em class="parameter"><code>attachmentCount</code></em>
</li><li class="listitem">
The value of any element of the <em class="parameter"><code>pPreserveAttachments</code></em> member in any
    given element of <em class="parameter"><code>pSubpasses</code></em> <span class="normative">must</span> not be
    <code class="code">VK_ATTACHMENT_UNUSED</code>
</li></ul></div></div><div class="sidebar"><div class="titlepage"><div><div><p class="title"><strong>Valid Usage (Implicit)</strong></p></div></div></div><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem">
<em class="parameter"><code>sType</code></em> <span class="normative">must</span> be <code class="code">VK_STRUCTURE_TYPE_RENDER_PASS_CREATE_INFO</code>
</li><li class="listitem">
<em class="parameter"><code>pNext</code></em> <span class="normative">must</span> be <code class="literal">NULL</code>
</li><li class="listitem">
<em class="parameter"><code>flags</code></em> <span class="normative">must</span> be <code class="literal">0</code>
</li><li class="listitem">
If <em class="parameter"><code>attachmentCount</code></em> is not <code class="literal">0</code>, <em class="parameter"><code>pAttachments</code></em> <span class="normative">must</span> be a pointer to an array of <em class="parameter"><code>attachmentCount</code></em> valid <code class="code">VkAttachmentDescription</code> structures
</li><li class="listitem">
<em class="parameter"><code>pSubpasses</code></em> <span class="normative">must</span> be a pointer to an array of <em class="parameter"><code>subpassCount</code></em> valid <code class="code">VkSubpassDescription</code> structures
</li><li class="listitem">
If <em class="parameter"><code>dependencyCount</code></em> is not <code class="literal">0</code>, <em class="parameter"><code>pDependencies</code></em> <span class="normative">must</span> be a pointer to an array of <em class="parameter"><code>dependencyCount</code></em> valid <code class="code">VkSubpassDependency</code> structures
</li><li class="listitem">
<em class="parameter"><code>subpassCount</code></em> <span class="normative">must</span> be greater than <code class="literal">0</code>
</li></ul></div></div><p>The <code class="code">VkAttachmentDescription</code> structure is defined as:</p><p><a id="VkAttachmentDescription"></a><strong> </strong>
</p><pre class="programlisting">typedef struct VkAttachmentDescription {
    VkAttachmentDescriptionFlags    flags;
    VkFormat                        format;
    VkSampleCountFlagBits           samples;
    VkAttachmentLoadOp              loadOp;
    VkAttachmentStoreOp             storeOp;
    VkAttachmentLoadOp              stencilLoadOp;
    VkAttachmentStoreOp             stencilStoreOp;
    VkImageLayout                   initialLayout;
    VkImageLayout                   finalLayout;
} VkAttachmentDescription;</pre><p>
</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p class="simpara">
<em class="parameter"><code>flags</code></em> is a bitmask describing additional properties of the
    attachment.
    Bits which <span class="normative">can</span> be set include:
</p><p><a id="VkAttachmentDescriptionFlagBits"></a><strong> </strong>
</p><pre class="programlisting">typedef enum VkAttachmentDescriptionFlagBits {
    VK_ATTACHMENT_DESCRIPTION_MAY_ALIAS_BIT = 0x00000001,
} VkAttachmentDescriptionFlagBits;</pre><p>
</p></li><li class="listitem">
<em class="parameter"><code>format</code></em> is a <code class="code"><a class="link" href="ch31s03.html#VkFormat">VkFormat</a></code> value specifying the format of the
    image that will be used for the attachment.
</li><li class="listitem">
<em class="parameter"><code>samples</code></em> is the number of samples of the image as defined in
    <code class="code"><a class="link" href="ch31s02.html#VkSampleCountFlagBits">VkSampleCountFlagBits</a></code>.
</li><li class="listitem"><p class="simpara">
<em class="parameter"><code>loadOp</code></em> specifies how the contents of color and depth components of
    the attachment are treated at the beginning of the subpass where it is
    first used:
</p><p><a id="VkAttachmentLoadOp"></a><strong> </strong>
</p><pre class="programlisting">typedef enum VkAttachmentLoadOp {
    VK_ATTACHMENT_LOAD_OP_LOAD = 0,
    VK_ATTACHMENT_LOAD_OP_CLEAR = 1,
    VK_ATTACHMENT_LOAD_OP_DONT_CARE = 2,
} VkAttachmentLoadOp;</pre><p>
</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem">
<code class="code">VK_ATTACHMENT_LOAD_OP_LOAD</code> means the contents within the render
     area will be preserved.
</li><li class="listitem">
<code class="code">VK_ATTACHMENT_LOAD_OP_CLEAR</code> means the contents within the render
     area will be cleared to a uniform value, which is specified when a
     render pass instance is begun.
</li><li class="listitem">
<code class="code">VK_ATTACHMENT_LOAD_OP_DONT_CARE</code> means the contents within the
     area need not be preserved; the contents of the attachment will be
     undefined inside the render area.
</li></ul></div></li><li class="listitem"><p class="simpara">
<em class="parameter"><code>storeOp</code></em> specifies how the contents of color and depth components
    of the attachment are treated at the end of the subpass where it is last
    used:
</p><p><a id="VkAttachmentStoreOp"></a><strong> </strong>
</p><pre class="programlisting">typedef enum VkAttachmentStoreOp {
    VK_ATTACHMENT_STORE_OP_STORE = 0,
    VK_ATTACHMENT_STORE_OP_DONT_CARE = 1,
} VkAttachmentStoreOp;</pre><p>
</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem">
<code class="code">VK_ATTACHMENT_STORE_OP_STORE</code> means the contents within the render
     area are written to memory and will be available for reading after the
     render pass instance completes once the writes have been synchronized
     with <code class="code">VK_ACCESS_COLOR_ATTACHMENT_WRITE_BIT</code> (for color attachments)
     or <code class="code">VK_ACCESS_DEPTH_STENCIL_ATTACHMENT_WRITE_BIT</code> (for
     depth/stencil attachments).
</li><li class="listitem">
<code class="code">VK_ATTACHMENT_STORE_OP_DONT_CARE</code> means the contents within the
     render area are not needed after rendering, and <span class="normative">may</span> be discarded; the
     contents of the attachment will be undefined inside the render area.
</li></ul></div></li><li class="listitem">
<em class="parameter"><code>stencilLoadOp</code></em> specifies how the contents of stencil components of
    the attachment are treated at the beginning of the subpass where it is
    first used, and <span class="normative">must</span> be one of the same values allowed for <em class="parameter"><code>loadOp</code></em>
    above.
</li><li class="listitem">
<em class="parameter"><code>stencilStoreOp</code></em> specifies how the contents of stencil components of
    the attachment are treated at the end of the last subpass where it is
    used, and <span class="normative">must</span> be one of the same values allowed for <em class="parameter"><code>storeOp</code></em>
    above.
</li><li class="listitem">
<em class="parameter"><code>initialLayout</code></em> is the layout the attachment image subresource will
    be in when a render pass instance begins.
</li><li class="listitem">
<em class="parameter"><code>finalLayout</code></em> is the layout the attachment image subresource will be
    transitioned to when a render pass instance ends.
    During a render pass instance, an attachment <span class="normative">can</span> use a different layout
    in each subpass, if desired.
</li></ul></div><p>If the attachment uses a color format, then <em class="parameter"><code>loadOp</code></em> and <em class="parameter"><code>storeOp</code></em>
are used, and <em class="parameter"><code>stencilLoadOp</code></em> and <em class="parameter"><code>stencilStoreOp</code></em> are ignored.
If the format has depth and/or stencil components, <em class="parameter"><code>loadOp</code></em> and
<em class="parameter"><code>storeOp</code></em> apply only to the depth data, while <em class="parameter"><code>stencilLoadOp</code></em> and
<em class="parameter"><code>stencilStoreOp</code></em> define how the stencil data is handled.</p><p><a id="renderpass-precision"></a>During a render pass instance, input/color attachments with color formats
that have a component size of 8, 16, or 32 bits <span class="normative">must</span> be represented in the
attachment’s format throughout the instance.
Attachments with other floating- or fixed-point color formats, or with depth
components <span class="normative">may</span> be represented in a format with a precision higher than the
attachment format, but <span class="normative">must</span> be represented with the same range.
When such a component is loaded via the <em class="parameter"><code>loadOp</code></em>, it will be converted
into an implementation-dependent format used by the render pass.
Such components <span class="normative">must</span> be converted from the render pass format, to the
format of the attachment, before they are stored or resolved at the end of a
render pass instance via <em class="parameter"><code>storeOp</code></em>.
Conversions occur as described in <a class="link" href="ch02s07.html" title="2.7. Numeric Representation and Computation">Numeric Representation and Computation</a> and <a class="link" href="ch02s08.html" title="2.8. Fixed-Point Data Conversions">Fixed-Point Data Conversions</a>.</p><p><a id="renderpass-aliasing"></a>If <em class="parameter"><code>flags</code></em> includes <code class="code">VK_ATTACHMENT_DESCRIPTION_MAY_ALIAS_BIT</code>, then
the attachment is treated as if it shares physical memory with another
attachment in the same render pass.
This information limits the ability of the implementation to reorder certain
operations (like layout transitions and the <em class="parameter"><code>loadOp</code></em>) such that it is
not improperly reordered against other uses of the same physical memory via
a different attachment.
This is described in more detail below.</p><div class="sidebar"><div class="titlepage"><div><div><p class="title"><strong>Valid Usage</strong></p></div></div></div><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem">
<em class="parameter"><code>finalLayout</code></em> <span class="normative">must</span> not be <code class="code">VK_IMAGE_LAYOUT_UNDEFINED</code> or
    <code class="code">VK_IMAGE_LAYOUT_PREINITIALIZED</code>
</li></ul></div></div><div class="sidebar"><div class="titlepage"><div><div><p class="title"><strong>Valid Usage (Implicit)</strong></p></div></div></div><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem">
<em class="parameter"><code>flags</code></em> <span class="normative">must</span> be a valid combination of <code class="code"><a class="link" href="ch07s01.html#VkAttachmentDescriptionFlagBits">VkAttachmentDescriptionFlagBits</a></code> values
</li><li class="listitem">
<em class="parameter"><code>format</code></em> <span class="normative">must</span> be a valid <code class="code"><a class="link" href="ch31s03.html#VkFormat">VkFormat</a></code> value
</li><li class="listitem">
<em class="parameter"><code>samples</code></em> <span class="normative">must</span> be a valid <code class="code"><a class="link" href="ch31s02.html#VkSampleCountFlagBits">VkSampleCountFlagBits</a></code> value
</li><li class="listitem">
<em class="parameter"><code>loadOp</code></em> <span class="normative">must</span> be a valid <code class="code"><a class="link" href="ch07s01.html#VkAttachmentLoadOp">VkAttachmentLoadOp</a></code> value
</li><li class="listitem">
<em class="parameter"><code>storeOp</code></em> <span class="normative">must</span> be a valid <code class="code"><a class="link" href="ch07s01.html#VkAttachmentStoreOp">VkAttachmentStoreOp</a></code> value
</li><li class="listitem">
<em class="parameter"><code>stencilLoadOp</code></em> <span class="normative">must</span> be a valid <code class="code"><a class="link" href="ch07s01.html#VkAttachmentLoadOp">VkAttachmentLoadOp</a></code> value
</li><li class="listitem">
<em class="parameter"><code>stencilStoreOp</code></em> <span class="normative">must</span> be a valid <code class="code"><a class="link" href="ch07s01.html#VkAttachmentStoreOp">VkAttachmentStoreOp</a></code> value
</li><li class="listitem">
<em class="parameter"><code>initialLayout</code></em> <span class="normative">must</span> be a valid <code class="code"><a class="link" href="ch11s04.html#VkImageLayout">VkImageLayout</a></code> value
</li><li class="listitem">
<em class="parameter"><code>finalLayout</code></em> <span class="normative">must</span> be a valid <code class="code"><a class="link" href="ch11s04.html#VkImageLayout">VkImageLayout</a></code> value
</li></ul></div></div><div class="note" style="margin-left: 0; margin-right: 10%;"><table border="0" summary="Note: editing-note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="images/icons/note.png" /></td><th align="left">editing-note</th></tr><tr><td align="left" valign="top"><p>TODO (Jon) - the following text may need to be moved back to combine with
<code class="code"><a class="link" href="ch07s01.html#vkCreateRenderPass">vkCreateRenderPass</a></code> above for automatic ref page generation.</p></td></tr></table></div><p>If a render pass uses multiple attachments that alias the same device
memory, those attachments <span class="normative">must</span> each include the
<code class="code">VK_ATTACHMENT_DESCRIPTION_MAY_ALIAS_BIT</code> bit in their attachment
description flags.
Attachments aliasing the same memory occurs in multiple ways:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem">
Multiple attachments being assigned the same image view as part of
    framebuffer creation.
</li><li class="listitem">
Attachments using distinct image views that correspond to the same image
    subresource of an image.
</li><li class="listitem">
Attachments using views of distinct image subresources which are bound
    to overlapping memory.
</li></ul></div><p>Render passes <span class="normative">must</span> include subpass dependencies (either directly or via a
subpass dependency chain) between any two subpasses that operate on the same
attachment or aliasing attachments and those subpass dependencies <span class="normative">must</span>
include execution and memory dependencies separating uses of the aliases, if
at least one of those subpasses writes to one of the aliases.
Those dependencies <span class="normative">must</span> not include the <code class="code">VK_DEPENDENCY_BY_REGION_BIT</code>
if the aliases are views of distinct image subresources which overlap in
memory.</p><p>Multiple attachments that alias the same memory <span class="normative">must</span> not be used in a
single subpass.
A given attachment index <span class="normative">must</span> not be used multiple times in a single
subpass, with one exception: two subpass attachments <span class="normative">can</span> use the same
attachment index if at least one use is as an input attachment and neither
use is as a resolve or preserve attachment.
In other words, the same view <span class="normative">can</span> be used simultaneously as an input and
color or depth/stencil attachment, but <span class="normative">must</span> not be used as multiple color
or depth/stencil attachments nor as resolve or preserve attachments.
This valid scenario is described in more detail <a class="link" href="ch07s01.html#renderpass-feedbackloop">below</a>.</p><p>If a set of attachments alias each other, then all except the first to be
used in the render pass <span class="normative">must</span> use an <em class="parameter"><code>initialLayout</code></em> of
<code class="code">VK_IMAGE_LAYOUT_UNDEFINED</code>, since the earlier uses of the other aliases
make their contents undefined.
Once an alias has been used and a different alias has been used after it,
the first alias <span class="normative">must</span> not be used in any later subpasses.
However, an application <span class="normative">can</span> assign the same image view to multiple aliasing
attachment indices, which allows that image view to be used multiple times
even if other aliases are used in between.
Once an attachment needs the <code class="code">VK_ATTACHMENT_DESCRIPTION_MAY_ALIAS_BIT</code>
bit, there <span class="normative">should</span> be no additional cost of introducing additional aliases,
and using these additional aliases <span class="normative">may</span> allow more efficient clearing of the
attachments on multiple uses via <code class="code">VK_ATTACHMENT_LOAD_OP_CLEAR</code>.</p><div class="note" style="margin-left: 0; margin-right: 10%;"><table border="0" summary="Note: Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="images/icons/note.png" /></td><th align="left">Note</th></tr><tr><td align="left" valign="top"><p>The exact set of attachment indices that alias with each other is not known
until a framebuffer is created using the render pass, so the above
conditions <span class="normative">cannot</span> be validated at render pass creation time.</p></td></tr></table></div><p>The <code class="code">VkSubpassDescription</code> structure is defined as:</p><p><a id="VkSubpassDescription"></a><strong> </strong>
</p><pre class="programlisting">typedef struct VkSubpassDescription {
    VkSubpassDescriptionFlags       flags;
    VkPipelineBindPoint             pipelineBindPoint;
    uint32_t                        inputAttachmentCount;
    const VkAttachmentReference*    pInputAttachments;
    uint32_t                        colorAttachmentCount;
    const VkAttachmentReference*    pColorAttachments;
    const VkAttachmentReference*    pResolveAttachments;
    const VkAttachmentReference*    pDepthStencilAttachment;
    uint32_t                        preserveAttachmentCount;
    const uint32_t*                 pPreserveAttachments;
} VkSubpassDescription;</pre><p>
</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem">
<em class="parameter"><code>flags</code></em> is reserved for future use.
</li><li class="listitem">
<em class="parameter"><code>pipelineBindPoint</code></em> is a <code class="code"><a class="link" href="ch09s08.html#VkPipelineBindPoint">VkPipelineBindPoint</a></code> value specifying
    whether this is a compute or graphics subpass.
    Currently, only graphics subpasses are supported.
</li><li class="listitem">
<em class="parameter"><code>inputAttachmentCount</code></em> is the number of input attachments.
</li><li class="listitem">
<em class="parameter"><code>pInputAttachments</code></em> is an array of <code class="code"><a class="link" href="ch07s01.html#VkAttachmentReference">VkAttachmentReference</a></code>
    structures (defined below) that lists which of the render pass’s
    attachments <span class="normative">can</span> be read in the shader during the subpass, and what
    layout each attachment will be in during the subpass.
    Each element of the array corresponds to an input attachment unit number
    in the shader, i.e. if the shader declares an input variable
    <code class="literal">layout(input_attachment_index=X, set=Y, binding=Z)</code> then it uses the
    attachment provided in <em class="parameter"><code>pInputAttachments</code></em>[X].
    Input attachments <span class="normative">must</span> also be bound to the pipeline with a descriptor
    set, with the input attachment descriptor written in the location
    (set=Y, binding=Z).
</li><li class="listitem">
<em class="parameter"><code>colorAttachmentCount</code></em> is the number of color attachments.
</li><li class="listitem">
<em class="parameter"><code>pColorAttachments</code></em> is an array of <em class="parameter"><code>colorAttachmentCount</code></em>
    <code class="code"><a class="link" href="ch07s01.html#VkAttachmentReference">VkAttachmentReference</a></code> structures that lists which of the render
    pass’s attachments will be used as color attachments in the subpass, and
    what layout each attachment will be in during the subpass.
    Each element of the array corresponds to a fragment shader output
    location, i.e. if the shader declared an output variable
    <code class="literal">layout(location=X)</code> then it uses the attachment provided in
    <em class="parameter"><code>pColorAttachments</code></em>[X].
</li><li class="listitem">
<em class="parameter"><code>pResolveAttachments</code></em> is <code class="literal">NULL</code> or an array of
    <em class="parameter"><code>colorAttachmentCount</code></em> <code class="code"><a class="link" href="ch07s01.html#VkAttachmentReference">VkAttachmentReference</a></code> structures that
    lists which of the render pass’s attachments are resolved to at the end
    of the subpass, and what layout each attachment will be in during the
    resolve.
    If <em class="parameter"><code>pResolveAttachments</code></em> is not <code class="literal">NULL</code>, each of its elements
    corresponds to a color attachment (the element in
    <em class="parameter"><code>pColorAttachments</code></em> at the same index).
    At the end of each subpass, the subpass’s color attachments are resolved
    to corresponding resolve attachments, unless the resolve attachment
    index is <code class="code">VK_ATTACHMENT_UNUSED</code> or <em class="parameter"><code>pResolveAttachments</code></em> is
    <code class="literal">NULL</code>.
    If the first use of an attachment in a render pass is as a resolve
    attachment, then the <em class="parameter"><code>loadOp</code></em> is effectively ignored as the resolve
    is guaranteed to overwrite all pixels in the render area.
</li><li class="listitem">
<em class="parameter"><code>pDepthStencilAttachment</code></em> is a pointer to a
    <code class="code"><a class="link" href="ch07s01.html#VkAttachmentReference">VkAttachmentReference</a></code> specifying which attachment will be used for
    depth/stencil data and the layout it will be in during the subpass.
    Setting the attachment index to <code class="code">VK_ATTACHMENT_UNUSED</code> or leaving
    this pointer as <code class="literal">NULL</code> indicates that no depth/stencil attachment will
    be used in the subpass.
</li><li class="listitem">
<em class="parameter"><code>preserveAttachmentCount</code></em> is the number of preserved attachments.
</li><li class="listitem">
<em class="parameter"><code>pPreserveAttachments</code></em> is an array of <em class="parameter"><code>preserveAttachmentCount</code></em>
    render pass attachment indices describing the attachments that are not
    used by a subpass, but whose contents <span class="normative">must</span> be preserved throughout the
    subpass.
</li></ul></div><p>The contents of an attachment within the render area become undefined at the
start of a subpass S if all of the following conditions are true:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem">
The attachment is used as a color, depth/stencil, or resolve attachment
    in any subpass in the render pass.
</li><li class="listitem">
There is a subpass S1 that uses or preserves the attachment, and a
    subpass dependency from S1 to S.
</li><li class="listitem">
The attachment is not used or preserved in subpass S.
</li></ul></div><p>Once the contents of an attachment become undefined in subpass S, they
remain undefined for subpasses in subpass dependency chains starting with
subpass S until they are written again.
However, they remain valid for subpasses in other subpass dependency chains
starting with subpass S1 if those subpasses use or preserve the attachment.</p><div class="sidebar"><div class="titlepage"><div><div><p class="title"><strong>Valid Usage</strong></p></div></div></div><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem">
<em class="parameter"><code>pipelineBindPoint</code></em> <span class="normative">must</span> be <code class="code">VK_PIPELINE_BIND_POINT_GRAPHICS</code>
</li><li class="listitem">
<em class="parameter"><code>colorAttachmentCount</code></em> <span class="normative">must</span> be less than or equal to
    <code class="code">VkPhysicalDeviceLimits</code>::<em class="parameter"><code>maxColorAttachments</code></em>
</li><li class="listitem">
If the first use of an attachment in this render pass is as an input
    attachment, and the attachment is not also used as a color or
    depth/stencil attachment in the same subpass, then <em class="parameter"><code>loadOp</code></em> <span class="normative">must</span>
    not be <code class="code">VK_ATTACHMENT_LOAD_OP_CLEAR</code>
</li><li class="listitem">
If <em class="parameter"><code>pResolveAttachments</code></em> is not <code class="literal">NULL</code>, for each resolve attachment
    that does not have the value <code class="code">VK_ATTACHMENT_UNUSED</code>, the
    corresponding color attachment <span class="normative">must</span> not have the value
    <code class="code">VK_ATTACHMENT_UNUSED</code>
</li><li class="listitem">
If <em class="parameter"><code>pResolveAttachments</code></em> is not <code class="literal">NULL</code>, the sample count of each
    element of <em class="parameter"><code>pColorAttachments</code></em> <span class="normative">must</span> be anything other than
    <code class="code">VK_SAMPLE_COUNT_1_BIT</code>
</li><li class="listitem">
Any given element of <em class="parameter"><code>pResolveAttachments</code></em> <span class="normative">must</span> have a sample count
    of <code class="code">VK_SAMPLE_COUNT_1_BIT</code>
</li><li class="listitem">
Any given element of <em class="parameter"><code>pResolveAttachments</code></em> <span class="normative">must</span> have the same
    <code class="code"><a class="link" href="ch31s03.html#VkFormat">VkFormat</a></code> as its corresponding color attachment
</li><li class="listitem">
All attachments in <em class="parameter"><code>pColorAttachments</code></em> and
    <em class="parameter"><code>pDepthStencilAttachment</code></em> that are not <code class="code">VK_ATTACHMENT_UNUSED</code>
    <span class="normative">must</span> have the same sample count
</li><li class="listitem">
If any input attachments are <code class="code">VK_ATTACHMENT_UNUSED</code>, then any
    pipelines bound during the subpass <span class="normative">must</span> not access those input
    attachments from the fragment shader
</li><li class="listitem">
The <em class="parameter"><code>attachment</code></em> member of any element of <em class="parameter"><code>pPreserveAttachments</code></em>
    <span class="normative">must</span> not be <code class="code">VK_ATTACHMENT_UNUSED</code>
</li><li class="listitem">
Any given element of <em class="parameter"><code>pPreserveAttachments</code></em> <span class="normative">must</span> not also be an
    element of any other member of the subpass description
</li><li class="listitem">
If any attachment is used as both an input attachment and a color or
    depth/stencil attachment, then each use <span class="normative">must</span> use the same <em class="parameter"><code>layout</code></em>
</li></ul></div></div><div class="sidebar"><div class="titlepage"><div><div><p class="title"><strong>Valid Usage (Implicit)</strong></p></div></div></div><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem">
<em class="parameter"><code>flags</code></em> <span class="normative">must</span> be <code class="literal">0</code>
</li><li class="listitem">
<em class="parameter"><code>pipelineBindPoint</code></em> <span class="normative">must</span> be a valid <code class="code"><a class="link" href="ch09s08.html#VkPipelineBindPoint">VkPipelineBindPoint</a></code> value
</li><li class="listitem">
If <em class="parameter"><code>inputAttachmentCount</code></em> is not <code class="literal">0</code>, <em class="parameter"><code>pInputAttachments</code></em> <span class="normative">must</span> be a pointer to an array of <em class="parameter"><code>inputAttachmentCount</code></em> valid <code class="code">VkAttachmentReference</code> structures
</li><li class="listitem">
If <em class="parameter"><code>colorAttachmentCount</code></em> is not <code class="literal">0</code>, <em class="parameter"><code>pColorAttachments</code></em> <span class="normative">must</span> be a pointer to an array of <em class="parameter"><code>colorAttachmentCount</code></em> valid <code class="code">VkAttachmentReference</code> structures
</li><li class="listitem">
If <em class="parameter"><code>colorAttachmentCount</code></em> is not <code class="literal">0</code>, and <em class="parameter"><code>pResolveAttachments</code></em> is not <code class="literal">NULL</code>, <em class="parameter"><code>pResolveAttachments</code></em> <span class="normative">must</span> be a pointer to an array of <em class="parameter"><code>colorAttachmentCount</code></em> valid <code class="code">VkAttachmentReference</code> structures
</li><li class="listitem">
If <em class="parameter"><code>pDepthStencilAttachment</code></em> is not <code class="literal">NULL</code>, <em class="parameter"><code>pDepthStencilAttachment</code></em> <span class="normative">must</span> be a pointer to a valid <code class="code">VkAttachmentReference</code> structure
</li><li class="listitem">
If <em class="parameter"><code>preserveAttachmentCount</code></em> is not <code class="literal">0</code>, <em class="parameter"><code>pPreserveAttachments</code></em> <span class="normative">must</span> be a pointer to an array of <em class="parameter"><code>preserveAttachmentCount</code></em> <code class="code">uint32_t</code> values
</li></ul></div></div><p>The <code class="code">VkAttachmentReference</code> structure is defined as:</p><p><a id="VkAttachmentReference"></a><strong> </strong>
</p><pre class="programlisting">typedef struct VkAttachmentReference {
    uint32_t         attachment;
    VkImageLayout    layout;
} VkAttachmentReference;</pre><p>
</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem">
<em class="parameter"><code>attachment</code></em> is the index of the attachment of the render pass, and
    corresponds to the index of the corresponding element in the
    <em class="parameter"><code>pAttachments</code></em> array of the <code class="code">VkRenderPassCreateInfo</code> structure.
    If any color or depth/stencil attachments are
    <code class="code">VK_ATTACHMENT_UNUSED</code>, then no writes occur for those attachments.
</li><li class="listitem">
<em class="parameter"><code>layout</code></em> is a <code class="code"><a class="link" href="ch11s04.html#VkImageLayout">VkImageLayout</a></code> value specifying the layout the
    attachment uses during the subpass.
    The implementation will automatically perform layout transitions as
    needed between subpasses to make each subpass use the requested layouts.
</li></ul></div><div class="sidebar"><div class="titlepage"><div><div><p class="title"><strong>Valid Usage</strong></p></div></div></div><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem">
<em class="parameter"><code>layout</code></em> <span class="normative">must</span> not be <code class="code">VK_IMAGE_LAYOUT_UNDEFINED</code> or
    <code class="code">VK_IMAGE_LAYOUT_PREINITIALIZED</code>
</li></ul></div></div><div class="sidebar"><div class="titlepage"><div><div><p class="title"><strong>Valid Usage (Implicit)</strong></p></div></div></div><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem">
<em class="parameter"><code>layout</code></em> <span class="normative">must</span> be a valid <code class="code"><a class="link" href="ch11s04.html#VkImageLayout">VkImageLayout</a></code> value
</li></ul></div></div><p>The <code class="code">VkSubpassDependency</code> structure is defined as:</p><p><a id="VkSubpassDependency"></a><strong> </strong>
</p><pre class="programlisting">typedef struct VkSubpassDependency {
    uint32_t                srcSubpass;
    uint32_t                dstSubpass;
    VkPipelineStageFlags    srcStageMask;
    VkPipelineStageFlags    dstStageMask;
    VkAccessFlags           srcAccessMask;
    VkAccessFlags           dstAccessMask;
    VkDependencyFlags       dependencyFlags;
} VkSubpassDependency;</pre><p>
</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem">
<em class="parameter"><code>srcSubpass</code></em> and <em class="parameter"><code>dstSubpass</code></em> are the subpass indices of the
    producer and consumer subpasses, respectively.
    <em class="parameter"><code>srcSubpass</code></em> and <em class="parameter"><code>dstSubpass</code></em> <span class="normative">can</span> also have the special value
    <code class="code">VK_SUBPASS_EXTERNAL</code>.
    The source subpass <span class="normative">must</span> always be a lower numbered subpass than the
    destination subpass (excluding external subpasses and
    <a class="link" href="ch06s05.html#synchronization-pipeline-barriers-subpass-self-dependencies" title="6.5.1. Subpass Self-dependency">self-dependencies</a>), so that the order of subpass descriptions is a
    valid execution ordering, avoiding cycles in the dependency graph.
</li><li class="listitem"><p class="simpara">
<em class="parameter"><code>srcStageMask</code></em>, <em class="parameter"><code>dstStageMask</code></em>, <em class="parameter"><code>srcAccessMask</code></em>,
    <em class="parameter"><code>dstAccessMask</code></em>, and <em class="parameter"><code>dependencyFlags</code></em> describe an
    <a class="link" href="ch06s04.html" title="6.4. Execution And Memory Dependencies">execution and memory     dependency</a> between subpasses.
    The bits that <span class="normative">can</span> be included in <em class="parameter"><code>dependencyFlags</code></em> are:
</p><p><a id="VkDependencyFlagBits"></a><strong> </strong>
</p><pre class="programlisting">typedef enum VkDependencyFlagBits {
    VK_DEPENDENCY_BY_REGION_BIT = 0x00000001,
} VkDependencyFlagBits;</pre><p>
</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem">
If <em class="parameter"><code>dependencyFlags</code></em> contains <code class="code">VK_DEPENDENCY_BY_REGION_BIT</code>,
     then the dependency is by-region as defined in
     <a class="link" href="ch06s04.html" title="6.4. Execution And Memory Dependencies">Execution And      Memory Dependencies</a>.
</li></ul></div></li></ul></div><p>Each subpass dependency defines an execution and memory dependency between
two sets of commands, with the second set depending on the first set.
When <em class="parameter"><code>srcSubpass</code></em> does not equal <em class="parameter"><code>dstSubpass</code></em> then the first set of
commands is:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem">
All commands in the subpass indicated by <em class="parameter"><code>srcSubpass</code></em>, if
    <em class="parameter"><code>srcSubpass</code></em> is not <code class="code">VK_SUBPASS_EXTERNAL</code>.
</li><li class="listitem">
All commands before the render pass instance, if <em class="parameter"><code>srcSubpass</code></em> is
    <code class="code">VK_SUBPASS_EXTERNAL</code>.
</li></ul></div><p>While the corresponding second set of commands is:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem">
All commands in the subpass indicated by <em class="parameter"><code>dstSubpass</code></em>, if
    <em class="parameter"><code>dstSubpass</code></em> is not <code class="code">VK_SUBPASS_EXTERNAL</code>.
</li><li class="listitem">
All commands after the render pass instance, if <em class="parameter"><code>dstSubpass</code></em> is
    <code class="code">VK_SUBPASS_EXTERNAL</code>.
</li></ul></div><p>When <em class="parameter"><code>srcSubpass</code></em> equals <em class="parameter"><code>dstSubpass</code></em> then the first set consists of
commands in the subpass before a call to <code class="code"><a class="link" href="ch06s05.html#vkCmdPipelineBarrier">vkCmdPipelineBarrier</a></code> and the
second set consists of commands in the subpass following that same call as
described in the
<a class="link" href="ch06s05.html#synchronization-pipeline-barriers-subpass-self-dependencies" title="6.5.1. Subpass Self-dependency">Subpass Self-dependency</a> section.</p><p>The <em class="parameter"><code>srcStageMask</code></em>, <em class="parameter"><code>dstStageMask</code></em>, <em class="parameter"><code>srcAccessMask</code></em>,
<em class="parameter"><code>dstAccessMask</code></em>, and <em class="parameter"><code>dependencyFlags</code></em> parameters of the dependency
are interpreted the same way as for other dependencies, as described in
<a class="link" href="ch06.html" title="Chapter 6. Synchronization and Cache Control">Synchronization and Cache Control</a>.</p><div class="sidebar"><div class="titlepage"><div><div><p class="title"><strong>Valid Usage</strong></p></div></div></div><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem">
If the <a class="link" href="ch31s01.html#features-features-geometryShader">geometry shaders</a> feature is
    not enabled, <em class="parameter"><code>srcStageMask</code></em> <span class="normative">must</span> not contain
    <code class="code">VK_PIPELINE_STAGE_GEOMETRY_SHADER_BIT</code>
</li><li class="listitem">
If the <a class="link" href="ch31s01.html#features-features-geometryShader">geometry shaders</a> feature is
    not enabled, <em class="parameter"><code>dstStageMask</code></em> <span class="normative">must</span> not contain
    <code class="code">VK_PIPELINE_STAGE_GEOMETRY_SHADER_BIT</code>
</li><li class="listitem">
If the <a class="link" href="ch31s01.html#features-features-tessellationShader">tessellation shaders</a>
    feature is not enabled, <em class="parameter"><code>srcStageMask</code></em> <span class="normative">must</span> not contain
    <code class="code">VK_PIPELINE_STAGE_TESSELLATION_CONTROL_SHADER_BIT</code> or
    <code class="code">VK_PIPELINE_STAGE_TESSELLATION_EVALUATION_SHADER_BIT</code>
</li><li class="listitem">
If the <a class="link" href="ch31s01.html#features-features-tessellationShader">tessellation shaders</a>
    feature is not enabled, <em class="parameter"><code>dstStageMask</code></em> <span class="normative">must</span> not contain
    <code class="code">VK_PIPELINE_STAGE_TESSELLATION_CONTROL_SHADER_BIT</code> or
    <code class="code">VK_PIPELINE_STAGE_TESSELLATION_EVALUATION_SHADER_BIT</code>
</li><li class="listitem">
<em class="parameter"><code>srcSubpass</code></em> <span class="normative">must</span> be less than or equal to <em class="parameter"><code>dstSubpass</code></em>, unless
    one of them is <code class="code">VK_SUBPASS_EXTERNAL</code>, to avoid cyclic dependencies
    and ensure a valid execution order
</li><li class="listitem">
<em class="parameter"><code>srcSubpass</code></em> and <em class="parameter"><code>dstSubpass</code></em> <span class="normative">must</span> not both be equal to
    <code class="code">VK_SUBPASS_EXTERNAL</code>
</li><li class="listitem">
If <em class="parameter"><code>srcSubpass</code></em> is equal to <em class="parameter"><code>dstSubpass</code></em>, <em class="parameter"><code>srcStageMask</code></em> and
    <em class="parameter"><code>dstStageMask</code></em> <span class="normative">must</span> only contain one of
    <code class="code">VK_PIPELINE_STAGE_TOP_OF_PIPE_BIT</code>,
    <code class="code">VK_PIPELINE_STAGE_DRAW_INDIRECT_BIT</code>,
    <code class="code">VK_PIPELINE_STAGE_VERTEX_INPUT_BIT</code>,
    <code class="code">VK_PIPELINE_STAGE_VERTEX_SHADER_BIT</code>,
    <code class="code">VK_PIPELINE_STAGE_TESSELLATION_CONTROL_SHADER_BIT</code>,
    <code class="code">VK_PIPELINE_STAGE_TESSELLATION_EVALUATION_SHADER_BIT</code>,
    <code class="code">VK_PIPELINE_STAGE_GEOMETRY_SHADER_BIT</code>,
    <code class="code">VK_PIPELINE_STAGE_FRAGMENT_SHADER_BIT</code>,
    <code class="code">VK_PIPELINE_STAGE_EARLY_FRAGMENT_TESTS_BIT</code>,
    <code class="code">VK_PIPELINE_STAGE_LATE_FRAGMENT_TESTS_BIT</code>,
    <code class="code">VK_PIPELINE_STAGE_COLOR_ATTACHMENT_OUTPUT_BIT</code>,
    <code class="code">VK_PIPELINE_STAGE_BOTTOM_OF_PIPE_BIT</code>, or
    <code class="code">VK_PIPELINE_STAGE_ALL_GRAPHICS_BIT</code>
</li><li class="listitem">
If <em class="parameter"><code>srcSubpass</code></em> is equal to <em class="parameter"><code>dstSubpass</code></em>, the highest bit value
    included in <em class="parameter"><code>srcStageMask</code></em> <span class="normative">must</span> be less than or equal to the lowest
    bit value in <em class="parameter"><code>dstStageMask</code></em>
</li></ul></div></div><div class="sidebar"><div class="titlepage"><div><div><p class="title"><strong>Valid Usage (Implicit)</strong></p></div></div></div><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem">
<em class="parameter"><code>srcStageMask</code></em> <span class="normative">must</span> be a valid combination of <code class="code"><a class="link" href="ch06s05.html#VkPipelineStageFlagBits">VkPipelineStageFlagBits</a></code> values
</li><li class="listitem">
<em class="parameter"><code>srcStageMask</code></em> <span class="normative">must</span> not be <code class="literal">0</code>
</li><li class="listitem">
<em class="parameter"><code>dstStageMask</code></em> <span class="normative">must</span> be a valid combination of <code class="code"><a class="link" href="ch06s05.html#VkPipelineStageFlagBits">VkPipelineStageFlagBits</a></code> values
</li><li class="listitem">
<em class="parameter"><code>dstStageMask</code></em> <span class="normative">must</span> not be <code class="literal">0</code>
</li><li class="listitem">
<em class="parameter"><code>srcAccessMask</code></em> <span class="normative">must</span> be a valid combination of <code class="code"><a class="link" href="ch06s05.html#VkAccessFlagBits">VkAccessFlagBits</a></code> values
</li><li class="listitem">
<em class="parameter"><code>dstAccessMask</code></em> <span class="normative">must</span> be a valid combination of <code class="code"><a class="link" href="ch06s05.html#VkAccessFlagBits">VkAccessFlagBits</a></code> values
</li><li class="listitem">
<em class="parameter"><code>dependencyFlags</code></em> <span class="normative">must</span> be a valid combination of <code class="code"><a class="link" href="ch07s01.html#VkDependencyFlagBits">VkDependencyFlagBits</a></code> values
</li></ul></div></div><p>Automatic image layout transitions between subpasses also interact with the
subpass dependencies.
If two subpasses are connected by a dependency and those two subpasses use
the same attachment in a different layout, then the layout transition will
occur after the memory accesses via <em class="parameter"><code>srcAccessMask</code></em> have completed in
all pipeline stages included in <em class="parameter"><code>srcStageMask</code></em> in the source subpass,
and before any memory accesses via <em class="parameter"><code>dstAccessMask</code></em> occur in any pipeline
stages included in <em class="parameter"><code>dstStageMask</code></em> in the destination subpass.</p><p>The automatic image layout transitions from <em class="parameter"><code>initialLayout</code></em> to the first
used layout (if it is different) are performed according to the following
rules:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem">
If the attachment does not include the
    <code class="code">VK_ATTACHMENT_DESCRIPTION_MAY_ALIAS_BIT</code> bit and there is no
    subpass dependency from <code class="code">VK_SUBPASS_EXTERNAL</code> to the first subpass
    that uses the attachment, then it is as if there were such a dependency
    with <em class="parameter"><code>srcStageMask</code></em> = <em class="parameter"><code>srcAccessMask</code></em> = 0 and <em class="parameter"><code>dstStageMask</code></em>
    and <em class="parameter"><code>dstAccessMask</code></em> including all relevant bits (all graphics
    pipeline stages and all access types that use image resources), with the
    transition executing as part of that dependency.
    In other words, it <span class="normative">may</span> overlap work before the render pass instance and
    is complete before the subpass begins.
</li><li class="listitem">
If the attachment does not include the
    <code class="code">VK_ATTACHMENT_DESCRIPTION_MAY_ALIAS_BIT</code> bit and there is a subpass
    dependency from <code class="code">VK_SUBPASS_EXTERNAL</code> to the first subpass that uses
    the attachment, then the transition executes as part of that dependency
    and according to its stage and access masks.
    It <span class="normative">must</span> not overlap work that came before the render pass instance that
    is included in the source masks, but it <span class="normative">may</span> overlap work in previous
    subpasses.
</li><li class="listitem">
If the attachment includes the
    <code class="code">VK_ATTACHMENT_DESCRIPTION_MAY_ALIAS_BIT</code> bit, then the transition
    executes according to all the subpass dependencies with <em class="parameter"><code>dstSubpass</code></em>
    equal to the first subpass index that the attachment is used in.
    That is, it occurs after all memory accesses in the source stages and
    masks from all the source subpasses have completed and are available,
    and before the union of all the destination stages begin, and the new
    layout is visible to the union of all the destination access types.
    If there are no incoming subpass dependencies, then this case follows
    the first rule.
</li></ul></div><p>Similar rules apply for the transition to the <em class="parameter"><code>finalLayout</code></em>, using
dependencies with <em class="parameter"><code>dstSubpass</code></em> equal to <code class="code">VK_SUBPASS_EXTERNAL</code></p><p>If an attachment specifies the <code class="code">VK_ATTACHMENT_LOAD_OP_CLEAR</code> load
operation, then it will logically be cleared at the start of the first
subpass where it is used.</p><div class="note" style="margin-left: 0; margin-right: 10%;"><table border="0" summary="Note: Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="images/icons/note.png" /></td><th align="left">Note</th></tr><tr><td align="left" valign="top"><p>Implementations <span class="normative">may</span> move clears earlier as long as it does not affect the
operation of a render pass instance.
For example, an implementation <span class="normative">may</span> choose to clear all attachments at the
start of the render pass instance.
If an attachment has the <code class="code">VK_ATTACHMENT_DESCRIPTION_MAY_ALIAS_BIT</code> flag
set, then the clear <span class="normative">must</span> occur at the start of subpass where the attachment
is first used, in order to preserve the operation of the render pass
instance.</p></td></tr></table></div><p>The first use of an attachment <span class="normative">must</span> not specify a layout equal to
<code class="code">VK_IMAGE_LAYOUT_DEPTH_STENCIL_READ_ONLY_OPTIMAL</code> or
<code class="code">VK_IMAGE_LAYOUT_SHADER_READ_ONLY_OPTIMAL</code> if the attachment specifies
that the <em class="parameter"><code>loadOp</code></em> is <code class="code">VK_ATTACHMENT_LOAD_OP_CLEAR</code>.
If a subpass uses the same attachment as both an input attachment and either
a color attachment or a depth/stencil attachment, then both uses <span class="normative">must</span>
observe the result of the clear.</p><p>Similarly, if an attachment specifies that the <em class="parameter"><code>storeOp</code></em> is
<code class="code">VK_ATTACHMENT_STORE_OP_STORE</code>, then it will logically be stored at the
end of the last subpass where it is used.</p><div class="note" style="margin-left: 0; margin-right: 10%;"><table border="0" summary="Note: Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="images/icons/note.png" /></td><th align="left">Note</th></tr><tr><td align="left" valign="top"><p>Implementations <span class="normative">may</span> move stores later as long as it does not affect the
operation of a render pass instance.
If an attachment has the <code class="code">VK_ATTACHMENT_DESCRIPTION_MAY_ALIAS_BIT</code> flag
set, then the store <span class="normative">must</span> occur at the end of the highest numbered subpass
that uses the attachment.</p></td></tr></table></div><p>If an attachment is not used by any subpass, then the <em class="parameter"><code>loadOp</code></em> and the
<em class="parameter"><code>storeOp</code></em> are ignored and the attachment’s memory contents will not be
modified by execution of a render pass instance.</p><p>It will be common for a render pass to consist of a simple linear graph of
dependencies, where subpass N depends on subpass N-1 for all N, and the
operation of the memory barriers and layout transitions is fairly
straightforward to reason about for those simple cases.
But for more complex graphs, there are some rules that govern when there
<span class="normative">must</span> be dependencies between subpasses.</p><p>As stated earlier, render passes <span class="normative">must</span> include subpass dependencies which
(either directly or via a subpass dependency chain) separate any two
subpasses that operate on the same attachment or aliasing attachments, if at
least one of those subpasses writes to the attachment.
If an image layout changes between those two subpasses, the implementation
uses the stageMasks and accessMasks indicated by the subpass dependency as
the masks that control when the layout transition <span class="normative">must</span> occur.
If there is not a layout change on the attachment, or if an implementation
treats the two layouts identically, then it <span class="normative">may</span> treat the dependency as a
simple execution/memory barrier.</p><p>If two subpasses use the same attachment in different layouts but both uses
are read-only (i.e. input attachment, or read-only depth/stencil
attachment), the application does not need to express a dependency between
the two subpasses.
Implementations that treat the two layouts differently <span class="normative">may</span> deduce and
insert a dependency between the subpasses, with the implementation choosing
the appropriate stage masks and access masks based on whether the attachment
is used as an input or depth/stencil attachment, and <span class="normative">may</span> insert the
appropriate layout transition along with the execution/memory barrier.
Implementations that treat the two layouts identically need not insert a
barrier, and the two subpasses <span class="normative">may</span> execute simultaneously.
The stage masks and access masks are chosen as follows:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem">
for input attachments, stage mask =
    <code class="code">VK_PIPELINE_STAGE_FRAGMENT_SHADER_BIT</code>, access mask =
    <code class="code">VK_ACCESS_INPUT_ATTACHMENT_READ_BIT</code>.
</li><li class="listitem">
for depth/stencil attachments, stage mask =
    <code class="code">VK_PIPELINE_STAGE_EARLY_FRAGMENT_TESTS_BIT</code> |
    <code class="code">VK_PIPELINE_STAGE_LATE_FRAGMENT_TESTS_BIT</code>, access mask =
    <code class="code">VK_ACCESS_DEPTH_STENCIL_ATTACHMENT_READ_BIT</code>
</li></ul></div><p>where <em class="parameter"><code>srcStageMask</code></em> and <em class="parameter"><code>srcAccessMask</code></em> are taken based on usage in
the source subpass and <em class="parameter"><code>dstStageMask</code></em> and <em class="parameter"><code>dstAccessMask</code></em> are taken
based on usage in the destination subpass.</p><p><a id="renderpass-feedbackloop"></a>If a subpass uses the same attachment as both an input attachment and either
a color attachment or a depth/stencil attachment, reads from the input
attachment are not automatically coherent with writes through the color or
depth/stencil attachment.
In order to achieve well-defined results, one of two criteria <span class="normative">must</span> be
satisfied.
First, if the color components or depth/stencil components read by the input
attachment are mutually exclusive with the components written by the color
or depth/stencil attachment then there is no <span class="emphasis"><em>feedback loop</em></span> and the reads
and writes both function normally, with the reads observing values from the
previous subpass(es) or from memory.
This option requires the graphics pipelines used by the subpass to disable
writes to color components that are read as inputs via the
<em class="parameter"><code>colorWriteMask</code></em>, and to disable writes to depth/stencil components that
are read as inputs via <em class="parameter"><code>depthWriteEnable</code></em> or <em class="parameter"><code>stencilTestEnable</code></em>.</p><p>Second, if the input attachment reads components that are written by the
color or depth/stencil attachment, then there is a feedback loop and a
pipeline barrier <span class="normative">must</span> be used between when the attachment is written and
when it is subsequently read by later fragments.
This pipeline barrier <span class="normative">must</span> follow the rules of a self-dependency as
described in
<a class="link" href="ch06s05.html#synchronization-pipeline-barriers-subpass-self-dependencies" title="6.5.1. Subpass Self-dependency">Subpass Self-dependency</a>, where the barrier’s flags include:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem">
<em class="parameter"><code>dstStageMask</code></em> = <code class="code">VK_PIPELINE_STAGE_FRAGMENT_SHADER_BIT</code>,
</li><li class="listitem">
<em class="parameter"><code>dstAccessMask</code></em> = <code class="code">VK_ACCESS_INPUT_ATTACHMENT_READ_BIT</code>, and
</li><li class="listitem">
<em class="parameter"><code>srcAccessMask</code></em> = <code class="code">VK_ACCESS_COLOR_ATTACHMENT_WRITE_BIT</code> (for
    color attachments) or <em class="parameter"><code>srcAccessMask</code></em> =
    <code class="code">VK_ACCESS_DEPTH_STENCIL_ATTACHMENT_WRITE_BIT</code> (for depth/stencil
    attachments).
</li><li class="listitem">
<em class="parameter"><code>srcStageMask</code></em> = <code class="code">VK_PIPELINE_STAGE_COLOR_ATTACHMENT_OUTPUT_BIT</code>
    (for color attachments) or <em class="parameter"><code>srcStageMask</code></em> =
    <code class="code">VK_PIPELINE_STAGE_LATE_FRAGMENT_TESTS_BIT</code> |
    <code class="code">VK_PIPELINE_STAGE_EARLY_FRAGMENT_TESTS_BIT</code> (for depth/stencil
    attachments).
</li><li class="listitem">
<em class="parameter"><code>dependencyFlags</code></em> = <code class="code">VK_DEPENDENCY_BY_REGION_BIT</code>.
</li></ul></div><p>A pipeline barrier is needed each time a fragment will read a particular
(x,y,layer,sample) location if that location has been written since the most
recent pipeline barrier, or since the start of the subpass if there have
been no pipeline barriers since the start of the subpass.</p><p>An attachment used as both an input attachment and color attachment <span class="normative">must</span> be
in the <code class="code">VK_IMAGE_LAYOUT_GENERAL</code> layout.
An attachment used as both an input attachment and depth/stencil attachment
<span class="normative">must</span> be in either the <code class="code">VK_IMAGE_LAYOUT_GENERAL</code> or
<code class="code">VK_IMAGE_LAYOUT_DEPTH_STENCIL_READ_ONLY_OPTIMAL</code> layout.
Since an attachment in the
<code class="code">VK_IMAGE_LAYOUT_DEPTH_STENCIL_READ_ONLY_OPTIMAL</code> layout is read-only,
this situation is not a feedback loop.</p><p>To destroy a render pass, call:</p><p><a id="vkDestroyRenderPass"></a><strong> </strong>
</p><pre class="programlisting">void vkDestroyRenderPass(
    VkDevice                                    device,
    VkRenderPass                                renderPass,
    const VkAllocationCallbacks*                pAllocator);</pre><p>
</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem">
<em class="parameter"><code>device</code></em> is the logical device that destroys the render pass.
</li><li class="listitem">
<em class="parameter"><code>renderPass</code></em> is the handle of the render pass to destroy.
</li><li class="listitem">
<em class="parameter"><code>pAllocator</code></em> controls host memory allocation as described in the
    <a class="link" href="ch10s01.html#memory-allocation">Memory Allocation</a> chapter.
</li></ul></div><div class="sidebar"><div class="titlepage"><div><div><p class="title"><strong>Valid Usage</strong></p></div></div></div><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem">
All submitted commands that refer to <em class="parameter"><code>renderPass</code></em> <span class="normative">must</span> have
    completed execution
</li><li class="listitem">
If <code class="code">VkAllocationCallbacks</code> were provided when <em class="parameter"><code>renderPass</code></em> was
    created, a compatible set of callbacks <span class="normative">must</span> be provided here
</li><li class="listitem">
If no <code class="code">VkAllocationCallbacks</code> were provided when <em class="parameter"><code>renderPass</code></em>
    was created, <em class="parameter"><code>pAllocator</code></em> <span class="normative">must</span> be <code class="literal">NULL</code>
</li></ul></div></div><div class="sidebar"><div class="titlepage"><div><div><p class="title"><strong>Valid Usage (Implicit)</strong></p></div></div></div><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem">
<em class="parameter"><code>device</code></em> <span class="normative">must</span> be a valid <code class="code">VkDevice</code> handle
</li><li class="listitem">
If <em class="parameter"><code>renderPass</code></em> is not <code class="code"><a class="link" href="apds03.html#VK_NULL_HANDLE">VK_NULL_HANDLE</a></code>, <em class="parameter"><code>renderPass</code></em> <span class="normative">must</span> be a valid <code class="code">VkRenderPass</code> handle
</li><li class="listitem">
If <em class="parameter"><code>pAllocator</code></em> is not <code class="literal">NULL</code>, <em class="parameter"><code>pAllocator</code></em> <span class="normative">must</span> be a pointer to a valid <code class="code">VkAllocationCallbacks</code> structure
</li><li class="listitem">
If <em class="parameter"><code>renderPass</code></em> is a valid handle, it <span class="normative">must</span> have been created, allocated, or retrieved from <em class="parameter"><code>device</code></em>
</li></ul></div></div><div class="sidebar"><div class="titlepage"><div><div><p class="title"><strong>Host Synchronization</strong></p></div></div></div><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem">
Host access to <em class="parameter"><code>renderPass</code></em> <span class="normative">must</span> be externally synchronized
</li></ul></div></div></div><div class="navfooter"><hr /><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="ch07.html"><img src="images/icons/prev.png" alt="Prev" /></a> </td><td width="20%" align="center"><a accesskey="u" href="ch07.html"><img src="images/icons/up.png" alt="Up" /></a></td><td width="40%" align="right"> <a accesskey="n" href="ch07s02.html"><img src="images/icons/next.png" alt="Next" /></a></td></tr><tr><td width="40%" align="left" valign="top"> </td><td width="20%" align="center"><a accesskey="h" href="index.html"><img src="images/icons/home.png" alt="Home" /></a></td><td width="40%" align="right" valign="top"> </td></tr></table></div></body></html>