<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>30.1. Layers</title><link rel="stylesheet" type="text/css" href="config/vkspec-xhtml.css" /><meta name="generator" content="DocBook XSL Stylesheets V1.79.1" /><link rel="home" href="index.html" title="Vulkan 1.0.30 - A Specification (with WSI extensions)" /><link rel="up" href="ch30.html" title="Chapter 30. Extended Functionality" /><link rel="prev" href="ch30.html" title="Chapter 30. Extended Functionality" /><link rel="next" href="ch30s02.html" title="30.2. Extensions" /><script xmlns="" type="text/x-mathjax-config">
        MathJax.Hub.Config({
            MathML: { extensions: ["content-mathml.js"] },
            tex2jax: { inlineMath: [['$','$'], ['\\(','\\)']] }
        });
    </script><script xmlns="" type="text/javascript" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script></head><body><div class="navheader"><table width="100%" summary="Navigation header"><tr><td width="20%" align="left"><a accesskey="p" href="ch30.html"><img src="images/icons/prev.png" alt="Prev" /></a> </td><th width="60%" align="center"> </th><td width="20%" align="right"> <a accesskey="n" href="ch30s02.html"><img src="images/icons/next.png" alt="Next" /></a></td></tr></table><hr /></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="extended-functionality-layers"></a>30.1. Layers</h2></div></div></div><p>When a layer is enabled, it inserts itself into the call chain for Vulkan
commands the layer is interested in.
A common use of layers is to validate application behavior during
development.
For example, the implementation will not check that Vulkan enums used by the
application fall within allowed ranges.
Instead, a validation layer would do those checks and flag issues.
This avoids a performance penalty during production use of the application
because those layers would not be enabled in production.</p><p>Vulkan layers <span class="normative">may</span> wrap object handles (i.e. return a different handle value
to the application than that generated by the implementation).
This is generally discouraged, as it increases the probability of
incompatibilities with new extensions.
The validation layers wrap handles in order to track the proper use and
destruction of each object.
See the <a class="link" href="ch01s04.html#LoaderAndValidationLayers">"Vulkan Loader Specification and Architecture Overview"</a> document for additional information.</p><p>To query the available layers, call:</p><p><a id="vkEnumerateInstanceLayerProperties"></a><strong> </strong>
</p><pre class="programlisting">VkResult vkEnumerateInstanceLayerProperties(
    uint32_t*                                   pPropertyCount,
    VkLayerProperties*                          pProperties);</pre><p>
</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem">
<em class="parameter"><code>pPropertyCount</code></em> is a pointer to an integer related to the number of
    layer properties available or queried, as described below.
</li><li class="listitem">
<em class="parameter"><code>pProperties</code></em> is either <code class="literal">NULL</code> or a pointer to an array of
    <code class="code"><a class="link" href="ch30s01.html#VkLayerProperties">VkLayerProperties</a></code> structures.
</li></ul></div><p>If <em class="parameter"><code>pProperties</code></em> is <code class="literal">NULL</code>, then the number of layer properties
available is returned in <em class="parameter"><code>pPropertyCount</code></em>.
Otherwise, <em class="parameter"><code>pPropertyCount</code></em> <span class="normative">must</span> point to a variable set by the user to
the number of elements in the <em class="parameter"><code>pProperties</code></em> array, and on return the
variable is overwritten with the number of structures actually written to
<em class="parameter"><code>pProperties</code></em>.
If <em class="parameter"><code>pPropertyCount</code></em> is less than the number of layer properties
available, at most <em class="parameter"><code>pPropertyCount</code></em> structures will be written.
If <em class="parameter"><code>pPropertyCount</code></em> is smaller than the number of layers available,
<code class="code">VK_INCOMPLETE</code> will be returned instead of <code class="code">VK_SUCCESS</code>, to
indicate that not all the available layer properties were returned.</p><p>The list of available layers may change at any time due to actions outside
of the Vulkan implementation, so two calls to
<span class="strong"><strong><code class="code">vkEnumerateInstanceLayerProperties</code></strong></span> with the same parameters <span class="normative">may</span>
return different results, or retrieve different <em class="parameter"><code>pPropertyCount</code></em> values
or <em class="parameter"><code>pProperties</code></em> contents.
Once an instance has been created, the layers enabled for that instance will
continue to be enabled and valid for the lifetime of that instance, even if
some of them become unavailable for future instances.</p><div class="sidebar"><div class="titlepage"><div><div><p class="title"><strong>Valid Usage (Implicit)</strong></p></div></div></div><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem">
<em class="parameter"><code>pPropertyCount</code></em> <span class="normative">must</span> be a pointer to a <code class="code">uint32_t</code> value
</li><li class="listitem">
If the value referenced by <em class="parameter"><code>pPropertyCount</code></em> is not <code class="literal">0</code>, and <em class="parameter"><code>pProperties</code></em> is not <code class="literal">NULL</code>, <em class="parameter"><code>pProperties</code></em> <span class="normative">must</span> be a pointer to an array of <em class="parameter"><code>pPropertyCount</code></em> <code class="code">VkLayerProperties</code> structures
</li></ul></div></div><div class="sidebar"><div class="titlepage"><div><div><p class="title"><strong>Return Codes</strong></p></div></div></div><div class="variablelist"><dl class="variablelist"><dt><span class="term">
<a class="link" href="ch02s06.html#fundamentals-successcodes" title="Success Codes">Success</a>
</span></dt><dd><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem">
<code class="code">VK_SUCCESS</code>
</li><li class="listitem">
<code class="code">VK_INCOMPLETE</code>
</li></ul></div></dd><dt><span class="term">
<a class="link" href="ch02s06.html#fundamentals-errorcodes" title="Error codes">Failure</a>
</span></dt><dd><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem">
<code class="code">VK_ERROR_OUT_OF_HOST_MEMORY</code>
</li><li class="listitem">
<code class="code">VK_ERROR_OUT_OF_DEVICE_MEMORY</code>
</li></ul></div></dd></dl></div></div><p>The <code class="code">VkLayerProperties</code> structure is defined as:</p><p><a id="VkLayerProperties"></a><strong> </strong>
</p><pre class="programlisting">typedef struct VkLayerProperties {
    char        layerName[VK_MAX_EXTENSION_NAME_SIZE];
    uint32_t    specVersion;
    uint32_t    implementationVersion;
    char        description[VK_MAX_DESCRIPTION_SIZE];
} VkLayerProperties;</pre><p>
</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem">
<em class="parameter"><code>layerName</code></em> is a null-terminated UTF-8 string specifying the name of
    the layer.
    Use this name in the <em class="parameter"><code>ppEnabledLayerNames</code></em> array passed in the
    <code class="code"><a class="link" href="ch03s02.html#VkInstanceCreateInfo">VkInstanceCreateInfo</a></code> structure to enable this layer for an
    instance.
</li><li class="listitem">
<em class="parameter"><code>specVersion</code></em> is the Vulkan version the layer was written to,
    encoded as described in the <a class="link" href="ch02s09.html" title="2.9. API Version Numbers and Semantics">API Version     Numbers and Semantics</a> section.
</li><li class="listitem">
<em class="parameter"><code>implementationVersion</code></em> is the version of this layer.
    It is an integer, increasing with backward compatible changes.
</li><li class="listitem">
<em class="parameter"><code>description</code></em> is a null-terminated UTF-8 string providing additional
    details that <span class="normative">can</span> be used by the application to identify the layer.
</li></ul></div><p>To enable a layer, the name of the layer <span class="normative">should</span> be added to the
<em class="parameter"><code>ppEnabledLayerNames</code></em> member of <code class="code"><a class="link" href="ch03s02.html#VkInstanceCreateInfo">VkInstanceCreateInfo</a></code> when creating
a <code class="code">VkInstance</code>.</p><p>Loader implementations <span class="normative">may</span> provide mechanisms outside the Vulkan API for
enabling specific layers.
Layers enabled through such a mechanism are <span class="emphasis"><em>implicitly enabled</em></span>, while
layers enabled by including the layer name in the <em class="parameter"><code>ppEnabledLayerNames</code></em>
member of <code class="code"><a class="link" href="ch03s02.html#VkInstanceCreateInfo">VkInstanceCreateInfo</a></code> are <span class="emphasis"><em>explicitly enabled</em></span>.
Except where otherwise specified, implicitly enabled and explicitly enabled
layers differ only in the way they are enabled.
Explicitly enabling a layer that is implicitly enabled has no additional
effect.</p><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="extended-functionality-device-layer-deprecation"></a>30.1.1. Device Layer Deprecation</h3></div></div></div><p>Previous versions of this specification distinguished between instance and
device layers.
Instance layers were only able to intercept commands that operate on
<code class="code">VkInstance</code> and <code class="code">VkPhysicalDevice</code>, except they were not able to
intercept <code class="code"><a class="link" href="ch04s02.html#vkCreateDevice">vkCreateDevice</a></code>.
Device layers were enabled for individual devices when they were created,
and could only intercept commands operating on that device or its child
objects.</p><p>Device-only layers are now deprecated, and this specification no longer
distinguishes between instance and device layers.
Layers are enabled during instance creation, and are able to intercept all
commands operating on that instance or any of its child objects.
At the time of deprecation there were no known device-only layers and no
compelling reason to create one.</p><p>In order to maintain compatibility with implementations released prior to
device-layer deprecation, applications <span class="normative">should</span> still enumerate and enable
device layers.
The behavior of <span class="strong"><strong><code class="code">vkEnumerateDeviceLayerProperties</code></strong></span> and valid usage of
the <em class="parameter"><code>ppEnabledLayerNames</code></em> member of <code class="code">VkDeviceCreateInfo</code> maximizes
compatibility with applications written to work with the previous
requirements.</p><p>To enumerate device layers, call:</p><p><a id="vkEnumerateDeviceLayerProperties"></a><strong> </strong>
</p><pre class="programlisting">VkResult vkEnumerateDeviceLayerProperties(
    VkPhysicalDevice                            physicalDevice,
    uint32_t*                                   pPropertyCount,
    VkLayerProperties*                          pProperties);</pre><p>
</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem">
<em class="parameter"><code>pPropertyCount</code></em> is a pointer to an integer related to the number of
    layer properties available or queried.
</li><li class="listitem">
<em class="parameter"><code>pProperties</code></em> is either <code class="literal">NULL</code> or a pointer to an array of
    <code class="code"><a class="link" href="ch30s01.html#VkLayerProperties">VkLayerProperties</a></code> structures.
</li></ul></div><p>If <em class="parameter"><code>pProperties</code></em> is <code class="literal">NULL</code>, then the number of layer properties
available is returned in <em class="parameter"><code>pPropertyCount</code></em>.
Otherwise, <em class="parameter"><code>pPropertyCount</code></em> <span class="normative">must</span> point to a variable set by the user to
the number of elements in the <em class="parameter"><code>pProperties</code></em> array, and on return the
variable is overwritten with the number of structures actually written to
<em class="parameter"><code>pProperties</code></em>.
If <em class="parameter"><code>pPropertyCount</code></em> is less than the number of layer properties
available, at most <em class="parameter"><code>pPropertyCount</code></em> structures will be written.
If <em class="parameter"><code>pPropertyCount</code></em> is smaller than the number of layers available,
<code class="code">VK_INCOMPLETE</code> will be returned instead of <code class="code">VK_SUCCESS</code>, to
indicate that not all the available layer properties were returned.</p><p>The list of layers enumerated by <span class="strong"><strong><code class="code">vkEnumerateDeviceLayerProperties</code></strong></span>
<span class="normative">must</span> be exactly the sequence of layers enabled for the instance.
The members of <code class="code">VkLayerProperties</code> for each enumerated layer <span class="normative">must</span> be
the same as the properties when the layer was enumerated by
<span class="strong"><strong><code class="code">vkEnumerateInstanceLayerProperties</code></strong></span>.</p><div class="sidebar"><div class="titlepage"><div><div><p class="title"><strong>Valid Usage (Implicit)</strong></p></div></div></div><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem">
<em class="parameter"><code>physicalDevice</code></em> <span class="normative">must</span> be a valid <code class="code">VkPhysicalDevice</code> handle
</li><li class="listitem">
<em class="parameter"><code>pPropertyCount</code></em> <span class="normative">must</span> be a pointer to a <code class="code">uint32_t</code> value
</li><li class="listitem">
If the value referenced by <em class="parameter"><code>pPropertyCount</code></em> is not <code class="literal">0</code>, and <em class="parameter"><code>pProperties</code></em> is not <code class="literal">NULL</code>, <em class="parameter"><code>pProperties</code></em> <span class="normative">must</span> be a pointer to an array of <em class="parameter"><code>pPropertyCount</code></em> <code class="code">VkLayerProperties</code> structures
</li></ul></div></div><div class="sidebar"><div class="titlepage"><div><div><p class="title"><strong>Return Codes</strong></p></div></div></div><div class="variablelist"><dl class="variablelist"><dt><span class="term">
<a class="link" href="ch02s06.html#fundamentals-successcodes" title="Success Codes">Success</a>
</span></dt><dd><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem">
<code class="code">VK_SUCCESS</code>
</li><li class="listitem">
<code class="code">VK_INCOMPLETE</code>
</li></ul></div></dd><dt><span class="term">
<a class="link" href="ch02s06.html#fundamentals-errorcodes" title="Error codes">Failure</a>
</span></dt><dd><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem">
<code class="code">VK_ERROR_OUT_OF_HOST_MEMORY</code>
</li><li class="listitem">
<code class="code">VK_ERROR_OUT_OF_DEVICE_MEMORY</code>
</li></ul></div></dd></dl></div></div><p>The <em class="parameter"><code>ppEnabledLayerNames</code></em> and <em class="parameter"><code>enabledLayerCount</code></em> members of
<code class="code">VkDeviceCreateInfo</code> are deprecated and their values <span class="normative">must</span> be ignored by
implementations.
However, for compatibility, only an empty list of layers or a list that
exactly matches the sequence enabled at instance creation time are valid,
and validation layers <span class="normative">should</span> issue diagnostics for other cases.</p><p>Regardless of the enabled layer list provided in <code class="code">VkDeviceCreateInfo</code>,
the sequence of layers active for a device will be exactly the sequence of
layers enabled when the parent instance was created.</p></div></div><div class="navfooter"><hr /><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="ch30.html"><img src="images/icons/prev.png" alt="Prev" /></a> </td><td width="20%" align="center"><a accesskey="u" href="ch30.html"><img src="images/icons/up.png" alt="Up" /></a></td><td width="40%" align="right"> <a accesskey="n" href="ch30s02.html"><img src="images/icons/next.png" alt="Next" /></a></td></tr><tr><td width="40%" align="left" valign="top"> </td><td width="20%" align="center"><a accesskey="h" href="index.html"><img src="images/icons/home.png" alt="Home" /></a></td><td width="40%" align="right" valign="top"> </td></tr></table></div></body></html>